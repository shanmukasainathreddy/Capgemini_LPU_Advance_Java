package com.practice;

import java.util.List;
import java.util.Scanner;
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;
import javax.persistence.TypedQuery;

public class ProductOperations {

     EntityManagerFactory emf = Persistence.createEntityManagerFactory("postgres");
    EntityManager em = emf.createEntityManager();
    EntityTransaction et = em.getTransaction();
    public  void addProduct(int id, String name, int qty, int price) {

        Product p = new Product();
        p.setPid(id);
        p.setName(name);
        p.setQuantity(qty);
        p.setPrice(price);

        et.begin();
        em.persist(p);
        et.commit();

        em.close();
        System.out.println("Product Inserted");
    }

    public  void updateProduct(int id, int newQty, int newPrice) {
        
        Product p = em.find(Product.class, id);

        if (p != null) {
            et.begin();
            p.setQuantity(newQty);
            p.setPrice(newPrice);
            et.commit();
            System.out.println("Product Updated");
        } else {
            System.out.println("Product Not Found");
        }

        em.close();
    }

    public  void findProduct(int id) {

        Product p = em.find(Product.class, id);

        if (p != null) {
            System.out.println(p.getPid() + " " + p.getName() + " " + p.getQuantity() + " " + p.getPrice());
        } else {
            System.out.println("Product Not Found");
        }

        em.close();
    }

    public  void findAllProducts() {

        TypedQuery<Product> q = em.createQuery("select p from Product p", Product.class);
        List<Product> list = q.getResultList();

        for (Product p : list) {
            System.out.println(p.getPid() + " " + p.getName() + " " + p.getQuantity() + " " + p.getPrice());
        }

        em.close();
    }

    public  void deleteProduct(int id) {

        Product p = em.find(Product.class, id);

        if (p != null) {
            et.begin();
            em.remove(p);
            et.commit();
            System.out.println("Product Deleted");
        } else {
            System.out.println("Product Not Found");
        }

        em.close();
    }

    public static void main(String[] args) {
    	
        Scanner sc = new Scanner(System.in);


        while (true) {
            System.out.println("\n----- Product Menu -----");
            System.out.println("1. Add Product");
            System.out.println("2. Update Product");
            System.out.println("3. Find Product by ID");
            System.out.println("4. Find All Products");
            System.out.println("5. Delete Product");
            System.out.println("6. Exit");

            System.out.print("Enter your choice: ");
            int ch = sc.nextInt();

            switch (ch) {

                case 1:
                    System.out.print("Enter Product ID: ");
                    int id = sc.nextInt();
                    System.out.print("Enter Name: ");
                    String name = sc.next();
                    System.out.print("Enter Quantity: ");
                    int qty = sc.nextInt();
                    System.out.print("Enter Price: ");
                    int price = sc.nextInt();

                    addProduct(id, name, qty, price);
                    break;

                case 2:
                    System.out.print("Enter Product ID: ");
                    int uid = sc.nextInt();
                    System.out.print("Enter New Quantity: ");
                    int newQty = sc.nextInt();
                    System.out.print("Enter New Price: ");
                    int newPrice = sc.nextInt();

                    updateProduct(uid, newQty, newPrice);
                    break;

                case 3:
                    System.out.print("Enter Product ID: ");
                    int fid = sc.nextInt();
                    findProduct(fid);
                    break;

                case 4:
                    findAllProducts();
                    break;

                case 5:
                    System.out.print("Enter Product ID to Delete: ");
                    int did = sc.nextInt();
                    deleteProduct(did);
                    break;

                case 6:
                    System.out.println("Bye Program Ended.");
                    emf.close();
                    System.exit(0);

                default:
                    System.out.println("Invalid Choice Try Again");
            }
        }
    }
}
